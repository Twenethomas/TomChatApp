<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard - TomChat</title>
  <!-- Using Bootstrap for quick styling (optional) -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    /* Additional admin page custom styles */
    body {
      background-color: #f0f2f5;
      font-family: 'Inter', sans-serif;
    }
    .wrapper {
      display: flex;
      min-height: 100vh;
    }
    /* Sidebar */
    #sidebar {
      min-width: 250px;
      max-width: 250px;
      background: #111b21;
      color: #fff;
      transition: all 0.3s;
    }
    #sidebar.active {
      margin-left: -250px;
    }
    #sidebar .sidebar-header {
      padding: 20px;
      background: #202c33;
      text-align: center;
    }
    #sidebar ul.components {
      padding: 20px 0;
      list-style: none;
    }
    #sidebar ul p {
      color: #fff;
      padding: 10px;
    }
    #sidebar ul li a {
      padding: 10px;
      font-size: 16px;
      display: block;
      color: #ddd;
      text-decoration: none;
      transition: all 0.3s;
    }
    #sidebar ul li a:hover {
      color: #fff;
      background: #6c63ff;
    }
    /* Page Content */
    #content {
      width: 100%;
      padding: 20px;
      min-height: 100vh;
      transition: all 0.3s;
    }
    /* Cards */
    .card {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <!-- Sidebar -->
    <nav id="sidebar" class="active">
      <div class="sidebar-header">
        <h3>Admin Dashboard</h3>
      </div>
      <ul class="list-unstyled components">
        <li>
          <a href="#users" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Users</a>
          <ul class="collapse list-unstyled" id="users">
            <li><a href="#" onclick="loadUsers()">All Users</a></li>
            <li><a href="#" onclick="loadOnlineUsers()">Online Users</a></li>
          </ul>
        </li>
        <li>
          <a href="#groups" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Groups</a>
          <ul class="collapse list-unstyled" id="groups">
            <li><a href="#" onclick="loadGroups()">All Groups</a></li>
          </ul>
        </li>
        <li>
          <a href="#messages" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Messages</a>
          <ul class="collapse list-unstyled" id="messages">
            <li><a href="#" onclick="loadMessages()">All Messages</a></li>
          </ul>
        </li>
      </ul>
    </nav>

    <!-- Page Content -->
    <div id="content">
      <h1 class="mt-4">Admin Dashboard</h1>
      <!-- Statistics Cards -->
      <div class="row">
        <div class="col-md-4">
          <div class="card bg-primary text-white">
            <div class="card-body">
              <h5 class="card-title">Total Users</h5>
              <p class="card-text" id="total-users">{{ users|length }}</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card bg-success text-white">
            <div class="card-body">
              <h5 class="card-title">Online Users</h5>
              <p class="card-text" id="online-users-count">{{ online_users_count }}</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card bg-warning text-white">
            <div class="card-body">
              <h5 class="card-title">Total Messages</h5>
              <p class="card-text" id="total-messages">{{ messages|length }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Users Table -->
      <h2>Users</h2>
      <table class="table table-hover table-striped">
        <thead class="thead-dark">
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Online</th>
            <th>Last Seen</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="users-table-body">
          {% for user in users %}
          <tr>
            <td>{{ user.custom_id }}</td>
            <td>{{ user.username }}</td>
            <td>{{ "Online" if user.is_online else "Offline" }}</td>
            <td>{{ user.last_seen.strftime('%Y-%m-%d %H:%M:%S') if user.last_seen else "Never" }}</td>
            <td>
              <a href="{{ url_for('admin.admin_view_user', user_id=user.custom_id) }}" class="btn btn-info btn-sm"><i class="fas fa-eye"></i></a>
              <button class="btn btn-danger btn-sm" onclick="deleteUser('{{ user.custom_id }}')"><i class="fas fa-trash"></i></button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Groups Table -->
      <h2>Groups</h2>
      <table class="table table-hover table-striped">
        <thead class="thead-dark">
          <tr>
            <th>ID</th>
            <th>Group Name</th>
            <th>Created By</th>
            <th>Created At</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="groups-table-body">
          {% for group in groups %}
          <tr>
            <td>{{ group.custom_id }}</td>
            <td>{{ group.group_name }}</td>
            <td>{{ group.created_by }}</td>
            <td>{{ group.created_at.strftime('%Y-%m-%d %H:%M:%S') }}</td>
            <td>
              <button class="btn btn-danger btn-sm" onclick="deleteGroup('{{ group.custom_id }}')"><i class="fas fa-trash"></i></button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Messages Table -->
      <h2>Messages</h2>
      <table class="table table-hover table-striped">
        <thead class="thead-dark">
          <tr>
            <th>ID</th>
            <th>Sender</th>
            <th>Receiver</th>
            <th>Message</th>
            <th>Timestamp</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="messages-table-body">
          {% for message in messages %}
          <tr>
            <td>{{ message.custom_id }}</td>
            <td>{{ message.sender_id }}</td>
            <td>{{ message.receiver_id }}</td>
            <td>{{ message.message_text }}</td>
            <td>{{ message.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</td>
            <td>
              <button class="btn btn-danger btn-sm" onclick="deleteMessage('{{ message.custom_id }}')"><i class="fas fa-trash"></i></button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- JavaScript for handling actions -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
  <script>
    // Example: Delete user function (to be implemented on backend)
    function deleteUser(userId) {
      if (confirm("Are you sure you want to delete this user?")) {
        fetch(`/admin/delete_user/${userId}`, { method: "DELETE" })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert("User deleted successfully!");
              location.reload();
            } else {
              alert("Error deleting user: " + data.error);
            }
          });
      }
    }
    // Similarly, implement deleteGroup and deleteMessage functions.
  </script>
</body>
</html>
